<%- include('../partials/header') %>

<section id="show-page">
  <div>Month:</div>
  <div><%= budget.month %></div>
  <div>Year:</div>
  <div><%= budget.year %></div>
</section>

<form
  id="add-income-form"
  method="POST"
  action="/budgets/<%= budget._id %>/incomes"
>
  <label>Category:</label>
  <select name="category">
    <option value="Salary">Salary</option>
    <option value="Investments">Investments</option>
    <option value="Other">Other</option>
  </select>
  <label>Income Name:</label>
  <input type="text" name="incomeName" />
  <label>Amount:</label>
  <input type="text" name="amount" />
  <input type="submit" value="Add Income" />
</form>

<form
  id="add-expense-form"
  method="POST"
  action="/budgets/<%= budget._id %>/expenses"
>
  <label>Category:</label>
  <select name="category">
    <option value="Housing">Housing</option>
    <option value="Transportation">Transportation</option>
    <option value="Food">Food</option>
    <option value="Medical/Healthcare">Medical</option>
    <option value="Personal">Personal</option>
    <option value="Debt">Debt</option>
    <option value="Retirement">Discretionary</option>
    <option value="Other">Other</option>
  </select>
  <label>Expense Name:</label>
  <input type="text" name="expenseName" />
  <label>Amount:</label>
  <input type="text" name="amount" />
  <input type="submit" value="Add Expense" />
</form>

<section id="calculations">
  <% if (budget.incomes && budget.incomes.length && budget.expenses &&
  budget.expenses.length) { %>
  <div>
    Total Income: <%= budget.incomes.reduce((acc, i) => acc + i.amount, 0) %>
  </div>
  <div>
    Total Expenses: <%= budget.expenses.reduce((acc, e) => acc + e.amount, 0) %>
  </div>
  <div>
    Net Income: <%= budget.incomes.reduce((acc, i) => acc + i.amount, 0) -
    budget.expenses.reduce((acc, e) => acc + e.amount, 0) %>
  </div>
  <% } %>
</section>

<% if (budget.incomes && budget.incomes.length) { %>
<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Income Name</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    <% budget.incomes.forEach(function(i) { %>
    <tr>
      <td><%= i.category %></td>
      <td><%= i.incomeName %></td>
      <td><%= i.amount %></td>
      <td>
        <form action="/incomes/<%= i._id %>?_method=DELETE" method="POST">
          <button type="submit">X</button>
        </form>
      </td>
    </tr>
    <% }); %>
    <tr>
      <td colspan="3"></td>
    </tr>
  </tbody>
</table>
<% } else { %>
<h5>No Incomes Yet</h5>
<% } %> <% if (budget.expenses && budget.expenses.length) { %>
<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Expense Name</th>
      <th>Amount</th>
    </tr>
  </thead>
  <tbody>
    <% budget.expenses.forEach(function(e) { %>
    <tr>
      <td><%= e.category %></td>
      <td><%= e.expenseName %></td>
      <td><%= e.amount %></td>
      <td>
        <form action="/expenses/<%= e._id %>?_method=DELETE" method="POST">
          <button type="submit">X</button>
        </form>
      </td>
    </tr>
    <% }); %>
    <tr>
      <td colspan="3"></td>
    </tr>
  </tbody>
</table>
<% } else { %>
<h5>No Expenses Yet</h5>
<% } %> <%- include('../partials/footer') %>
